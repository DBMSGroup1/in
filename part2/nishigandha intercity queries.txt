
1st:
 SELECT tn.*
          FROM trains tn
          WHERE tn.train_id IN (
              SELECT c.train_id
              FROM coach c
              JOIN maintenance m ON c.coach_id = m.coach_id
              JOIN schedule s ON c.train_id = s.train_id
              JOIN route r ON s.route_id = r.route_id
              JOIN station start ON r.starting_station = start.station_id
              JOIN station last ON r.last_station = last.station_id
              WHERE (start.station_name = 'Goa' AND last.station_name = 'Mumbai')
                 OR (start.station_name = 'Ajmer' AND last.station_name = 'Lonavala')
              GROUP BY c.train_id
              HAVING SUM(CASE WHEN m.next_mentenance_date <= '2023-11-30' THEN 1 ELSE 0 END) >= COUNT(*) / 2
        );

4th: 
SELECT r.route_id, r.distance, r.avg_travel_time,r.operating_days, r.starting_station, r.last_station, COUNT(p.pass_id) AS senior_travelers_count
    FROM route r
    JOIN schedule s ON r.route_id = s.route_id
    JOIN ticket t ON s.schedule_id = t.schedule_id
    JOIN passenger p ON t.passenger_id = p.pass_id
    WHERE p.type = 'senior_citizen'
    GROUP BY r.route_id, r.starting_station, r.last_station
    ORDER BY senior_travelers_count DESC
    LIMIT 1;

3rd query:
select * from travel_agent where confirmed_booking>=10 and agent_id in (select travel_agent_id from ticket where booking_date between '2023-09-01' and '2023-09-30');

2nd query: 
select r.route_id, r.distance, r.avg_travel_time, r.operating_days, r.starting_station, r.last_station, count(case when p.type='child' then 1 end) as children_sold, count(case when p.type='adult' then 1 end) as adult_sold, count(case when p.type ='senior_citizen' then 1 end) as senior_sold, count(ss.schedule_id) as total_seats_sold
from route r
    left join schedule s on r.route_id = s.route_id
    left join seats_sold ss on s.schedule_id = ss.schedule_id
    left join ticket t on ss.schedule_id = t.schedule_id
    left join passenger p on t.passenger_id = p.pass_id
    where t.booking_date between '2023-10-01' and '2023-10-31'
    group by r.route_id
    order by total_seats_sold desc;

5th query:
select * from route where route_id in (select route_id from goes_to where is_late='No');